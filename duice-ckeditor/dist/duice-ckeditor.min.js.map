{"version":3,"file":"duice-ckeditor.min.js","sources":["CkeditorElement.js","CkeditorElementFactory.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ObjectElement } from \"duice\";\nimport { PropertyChangingEvent } from \"duice\";\n/**\n * Ckeditor Element\n */\nexport class CkeditorElement extends ObjectElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.editor = null; // CKEditor ì¸ìŠ¤í„´ìŠ¤\n        this.internalValue = null; // ì´ˆê¸° setValue ì €ìž¥\n        htmlElement.style.display = 'block';\n        // textarea\n        const textarea = document.createElement('textarea');\n        htmlElement.appendChild(textarea);\n        // CKEditor initialization\n        let _this = this;\n        ClassicEditor\n            .create(textarea, {\n            extraPlugins: [DefaultUploadPlugin]\n        })\n            .then((editor) => {\n            this.editor = editor;\n            // set initial value\n            if (this.internalValue !== null) {\n                this.editor.setData(this.internalValue);\n            }\n            // blur event\n            editor.editing.view.document.on('blur', (evt, data) => {\n                if (editor.getData() !== this.internalValue) {\n                    this.internalValue = editor.getData();\n                    this.notifyPropertyChanged();\n                }\n            });\n            // double check\n            editor.ui.view.editable.element.addEventListener('blur', () => {\n                if (editor.getData() !== this.internalValue) {\n                    this.internalValue = editor.getData();\n                    this.notifyPropertyChanged();\n                }\n            });\n        })\n            .catch((error) => {\n            console.error('Error initializing CKEditor:', error);\n        });\n    }\n    /**\n     * Notifies property changed\n     */\n    notifyPropertyChanged() {\n        let element = this.getHtmlElement();\n        let data = this.getBindData();\n        let event = new PropertyChangingEvent(element, data, this.getProperty(), this.getValue(), this.getIndex());\n        this.notifyObservers(event);\n    }\n    /**\n     * Sets value\n     * @param value property value\n     */\n    setValue(value) {\n        this.internalValue = value;\n        if (this.editor) {\n            this.editor.setData(value !== null && value !== void 0 ? value : '');\n        }\n    }\n    /**\n     * Gets value\n     */\n    getValue() {\n        return this.internalValue;\n    }\n    /**\n     * Sets readonly\n     * @param readonly readonly or not\n     */\n    setReadonly(readonly) {\n        if (this.editor) {\n            if (readonly === true) {\n                this.editor.enableReadOnlyMode('readonly');\n            }\n            else {\n                this.editor.disableReadOnlyMode('readonly');\n            }\n        }\n    }\n    /**\n     * Sets disabled\n     * @param disabled disabled or not\n     */\n    setDisabled(disabled) {\n        if (this.editor) {\n            if (disabled === true) {\n                this.editor.enableReadOnlyMode('disabled');\n            }\n            else {\n                this.editor.disableReadOnlyMode('disabled');\n            }\n        }\n    }\n}\n/**\n * Default Upload Plugin\n */\nclass DefaultUploadPlugin {\n    constructor(editor) {\n        editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {\n            console.log(\"== loader\", loader);\n            return new DefaultUploadAdapter(loader);\n        };\n    }\n}\n/**\n * Default Upload Adapter\n */\nclass DefaultUploadAdapter {\n    constructor(loader) {\n        this.loader = loader;\n    }\n    upload() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.loader.file\n                .then((file) => new Promise((resolve, reject) => {\n                const reader = new FileReader();\n                reader.onload = () => {\n                    resolve({\n                        default: reader.result\n                    });\n                };\n                reader.onerror = error => {\n                    reject(error);\n                };\n                reader.readAsDataURL(file); // ðŸ”¥ Base64\n            }));\n        });\n    }\n}\n//# sourceMappingURL=CkeditorElement.js.map","import { Configuration, ElementRegistry, ObjectElementFactory } from \"duice\";\nimport { CkeditorElement } from \"./CkeditorElement\";\n/**\n * Ckeditor Factory\n */\nexport class CkeditorElementFactory extends ObjectElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    createElement(htmlElement, bindData, context) {\n        return new CkeditorElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-ckeditor`, new CkeditorElementFactory());\n})();\n//# sourceMappingURL=CkeditorElementFactory.js.map"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","CkeditorElement","ObjectElement","constructor","htmlElement","bindData","context","super","this","editor","internalValue","style","display","textarea","document","createElement","appendChild","ClassicEditor","create","extraPlugins","DefaultUploadPlugin","setData","editing","view","on","evt","data","getData","notifyPropertyChanged","ui","editable","element","addEventListener","catch","error","console","getHtmlElement","getBindData","event","PropertyChangingEvent","getProperty","getValue","getIndex","notifyObservers","setValue","setReadonly","readonly","enableReadOnlyMode","disableReadOnlyMode","setDisabled","disabled","plugins","get","createUploadAdapter","loader","log","DefaultUploadAdapter","upload","file","reader","FileReader","onload","default","onerror","readAsDataURL","CkeditorElementFactory","ObjectElementFactory","ElementRegistry","register","Configuration","getNamespace"],"mappings":"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"}