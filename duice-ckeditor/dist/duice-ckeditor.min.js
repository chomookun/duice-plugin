/*!
 * duice-ckeditor - v0.3.0
 * git: https://gitbub.com/chomookun/duice-plugin
 * website: https://duice-plugin.chomookun.org
 * Released under the LGPL(GNU Lesser General Public License version 3) License
 */
this.duice=this.duice||{},this.duice.plugin=this.duice.plugin||{},this.duice.plugin.Ckeditor=function(e,t){"use strict";var i=function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function l(e){try{o(n.next(e))}catch(e){a(e)}}function s(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,s)}o((n=n.apply(e,t||[])).next())}))};class n extends t.ObjectElement{constructor(e,t,i){super(e,t,i),this.editor=null,this.internalValue=null,e.style.display="block";const n=document.createElement("textarea");e.appendChild(n),ClassicEditor.create(n,{extraPlugins:[r]}).then((e=>{this.editor=e,null!==this.internalValue&&this.editor.setData(this.internalValue),e.editing.view.document.on("blur",((t,i)=>{e.getData()!==this.internalValue&&(this.internalValue=e.getData(),this.notifyPropertyChanged())})),e.ui.view.editable.element.addEventListener("blur",(()=>{e.getData()!==this.internalValue&&(this.internalValue=e.getData(),this.notifyPropertyChanged())}))})).catch((e=>{console.error("Error initializing CKEditor:",e)}))}notifyPropertyChanged(){let e=this.getHtmlElement(),i=this.getBindData(),n=new t.PropertyChangingEvent(e,i,this.getProperty(),this.getValue(),this.getIndex());this.notifyObservers(n)}setValue(e){this.internalValue=e,this.editor&&this.editor.setData(null!=e?e:"")}getValue(){return this.internalValue}setReadonly(e){this.editor&&(!0===e?this.editor.enableReadOnlyMode("readonly"):this.editor.disableReadOnlyMode("readonly"))}setDisabled(e){this.editor&&(!0===e?this.editor.enableReadOnlyMode("disabled"):this.editor.disableReadOnlyMode("disabled"))}}class r{constructor(e){e.plugins.get("FileRepository").createUploadAdapter=e=>(console.log("== loader",e),new a(e))}}class a{constructor(e){this.loader=e}upload(){return i(this,void 0,void 0,(function*(){return this.loader.file.then((e=>new Promise(((t,i)=>{const n=new FileReader;n.onload=()=>{t({default:n.result})},n.onerror=e=>{i(e)},n.readAsDataURL(e)}))))}))}}class l extends t.ObjectElementFactory{createElement(e,t,i){return new n(e,t,i)}}return t.ElementRegistry.register(`${t.Configuration.getNamespace()}-ckeditor`,new l),e.CkeditorElement=n,e.CkeditorElementFactory=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({},duice);
//# sourceMappingURL=duice-ckeditor.min.js.map
