{"version":3,"file":"duice-ckeditor.js","sources":["CkeditorElement.js","CkeditorElementFactory.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ObjectElement } from \"duice\";\nimport { PropertyChangingEvent } from \"duice\";\n/**\n * Ckeditor Element\n */\nexport class CkeditorElement extends ObjectElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.editor = null; // CKEditor 인스턴스\n        this.internalValue = null; // 초기 setValue 저장\n        this.getHtmlElement().appendChild(this.createStyle());\n        // textarea\n        const textarea = document.createElement('textarea');\n        // textarea.style.height = this.getHtmlElement().style.height;\n        console.error(\"===========\", this.getHtmlElement().style.height);\n        htmlElement.appendChild(textarea);\n        // CKEditor initialization\n        let _this = this;\n        ClassicEditor\n            .create(textarea, {\n            extraPlugins: [DefaultUploadPlugin]\n        })\n            .then((editor) => {\n            this.editor = editor;\n            // set initial value\n            if (this.internalValue !== null) {\n                this.editor.setData(this.internalValue);\n            }\n            // blur event\n            editor.editing.view.document.on('blur', (evt, data) => {\n                if (editor.getData() !== this.internalValue) {\n                    this.internalValue = editor.getData();\n                    this.notifyPropertyChanged();\n                }\n            });\n            // double check\n            editor.ui.view.editable.element.addEventListener('blur', () => {\n                if (editor.getData() !== this.internalValue) {\n                    this.internalValue = editor.getData();\n                    this.notifyPropertyChanged();\n                }\n            });\n        })\n            .catch((error) => {\n            console.error('Error initializing CKEditor:', error);\n        });\n    }\n    /**\n     * Creates style\n     */\n    createStyle() {\n        let style = document.createElement('style');\n        style.innerHTML = `\n            .ck-editor {\n                display: flex;\n                flex-direction: column;\n                height: 100% !important;\n            }\n            .ck-editor__main {\n                flex: 1;\n            }\n            .ck-editor__editable_inline:not(.ck-comment__input *) {\n                height: 100%;\n            }\n        `;\n        return style;\n    }\n    /**\n     * Notifies property changed\n     */\n    notifyPropertyChanged() {\n        let element = this.getHtmlElement();\n        let data = this.getBindData();\n        let event = new PropertyChangingEvent(element, data, this.getProperty(), this.getValue(), this.getIndex());\n        this.notifyObservers(event);\n    }\n    /**\n     * Sets value\n     * @param value property value\n     */\n    setValue(value) {\n        this.internalValue = value;\n        if (this.editor) {\n            this.editor.setData(value !== null && value !== void 0 ? value : '');\n        }\n    }\n    /**\n     * Gets value\n     */\n    getValue() {\n        return this.internalValue;\n    }\n    /**\n     * Sets readonly\n     * @param readonly readonly or not\n     */\n    setReadonly(readonly) {\n        if (this.editor) {\n            if (readonly === true) {\n                this.editor.enableReadOnlyMode('readonly');\n            }\n            else {\n                this.editor.disableReadOnlyMode('readonly');\n            }\n        }\n    }\n    /**\n     * Sets disabled\n     * @param disabled disabled or not\n     */\n    setDisabled(disabled) {\n        if (this.editor) {\n            if (disabled === true) {\n                this.editor.enableReadOnlyMode('disabled');\n            }\n            else {\n                this.editor.disableReadOnlyMode('disabled');\n            }\n        }\n    }\n}\n/**\n * Default Upload Plugin\n */\nclass DefaultUploadPlugin {\n    constructor(editor) {\n        editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {\n            console.log(\"== loader\", loader);\n            return new DefaultUploadAdapter(loader);\n        };\n    }\n}\n/**\n * Default Upload Adapter\n */\nclass DefaultUploadAdapter {\n    constructor(loader) {\n        this.loader = loader;\n    }\n    upload() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.loader.file\n                .then((file) => new Promise((resolve, reject) => {\n                const reader = new FileReader();\n                reader.onload = () => {\n                    resolve({\n                        default: reader.result\n                    });\n                };\n                reader.onerror = error => {\n                    reject(error);\n                };\n                reader.readAsDataURL(file); // 🔥 Base64\n            }));\n        });\n    }\n}\n//# sourceMappingURL=CkeditorElement.js.map","import { Configuration, ElementRegistry, ObjectElementFactory } from \"duice\";\nimport { CkeditorElement } from \"./CkeditorElement\";\n/**\n * Ckeditor Factory\n */\nexport class CkeditorElementFactory extends ObjectElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    createElement(htmlElement, bindData, context) {\n        return new CkeditorElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-ckeditor`, new CkeditorElementFactory());\n})();\n//# sourceMappingURL=CkeditorElementFactory.js.map"],"names":["this","ObjectElement","PropertyChangingEvent","ObjectElementFactory","ElementRegistry","Configuration"],"mappings":"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"}