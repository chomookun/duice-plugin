{"version":3,"file":"duice-files.min.js","sources":["FilesElement.js","FilesElementFactory.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Configuration, CustomElement, findVariable } from \"duice\";\nimport { getElementAttribute, callFunction } from \"duice\";\n/**\n * Files Element\n */\nexport class FilesElement extends CustomElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.iconContent = '<svg style=\"display:block;\" xmlns=\"http://www.w3.org/2000/svg\"  viewBox=\"0 0 50 50\" width=\"1rem\" height=\"1rem\"><path d=\"M 7 2 L 7 48 L 43 48 L 43 14.59375 L 42.71875 14.28125 L 30.71875 2.28125 L 30.40625 2 Z M 9 4 L 29 4 L 29 16 L 41 16 L 41 46 L 9 46 Z M 31 5.4375 L 39.5625 14 L 31 14 Z\"/></svg>';\n        this.removeContent = '[-]';\n        this.addContent = '[+]';\n        // attributes\n        this.filenameProperty = getElementAttribute(htmlElement, 'filename-property');\n        this.sizeProperty = getElementAttribute(htmlElement, 'size-property');\n        const files = getElementAttribute(htmlElement, 'files');\n        this.files = files ? findVariable(context, files) : null;\n        // event listeners\n        const onClick = getElementAttribute(htmlElement, 'on-click');\n        this.onClick = onClick ? findVariable(context, onClick) : null;\n        const onAdd = getElementAttribute(htmlElement, 'on-add');\n        this.onAdd = onAdd ? findVariable(context, onAdd) : null;\n        const onRemove = getElementAttribute(htmlElement, 'on-remove');\n        this.onRemove = onRemove ? findVariable(context, onRemove) : null;\n        // custom style\n        this.iconContent = getElementAttribute(htmlElement, 'icon-content') || this.iconContent;\n        this.removeContent = getElementAttribute(htmlElement, 'remove-content') || this.removeContent;\n        this.addContent = getElementAttribute(htmlElement, 'add-content') || this.addContent;\n    }\n    /**\n     * Do render\n     * @param object\n     */\n    doRender(object) {\n        this.getHtmlElement().innerHTML = '';\n        this.getHtmlElement().appendChild(this.createStyle());\n        // items\n        let arrayProxy = this.getBindData();\n        arrayProxy.forEach((file, index) => {\n            let itemElement = this.createItemElement(file, index);\n            this.getHtmlElement().appendChild(itemElement);\n        });\n        // add button\n        if (this.files) {\n            let addButton = document.createElement('span');\n            addButton.innerHTML = this.addContent;\n            addButton.classList.add(`${Configuration.getNamespace()}-files__item-add`);\n            addButton.addEventListener('click', () => {\n                this.addFile().then();\n            });\n            this.getHtmlElement().appendChild(addButton);\n        }\n    }\n    createItemElement(item, index) {\n        let filename = item[this.filenameProperty];\n        let size = parseInt(item[this.sizeProperty]);\n        let itemElement = document.createElement('div');\n        itemElement.classList.add(`${Configuration.getNamespace()}-files__item`);\n        // icon\n        let iconElement = document.createElement('span');\n        iconElement.innerHTML = `${this.iconContent}`;\n        iconElement.classList.add(`${Configuration.getNamespace()}-files__item-icon`);\n        itemElement.appendChild(iconElement);\n        // filename\n        let filenameElement = document.createElement('span');\n        filenameElement.innerHTML = `${filename}`;\n        filenameElement.classList.add(`${Configuration.getNamespace()}-files__item-filename`);\n        itemElement.appendChild(filenameElement);\n        // on click listener\n        if (this.onClick) {\n            filenameElement.style.cursor = 'pointer';\n            filenameElement.addEventListener('click', () => {\n                console.log(this.onClick);\n                callFunction(this.onClick, filenameElement, item);\n            });\n        }\n        // size\n        let sizeElement = document.createElement('span');\n        sizeElement.innerHTML = `(${this.formatBytes(size)})`;\n        sizeElement.classList.add(`${Configuration.getNamespace()}-files__item-size`);\n        itemElement.appendChild(sizeElement);\n        // remove button\n        if (this.files) {\n            let removeButton = document.createElement('span');\n            removeButton.innerHTML = this.removeContent;\n            removeButton.classList.add(`${Configuration.getNamespace()}-files__item-remove`);\n            removeButton.dataset.index = index.toString();\n            let _this = this;\n            removeButton.addEventListener('click', function () {\n                let index = parseInt(this.dataset.index);\n                _this.removeFile(index);\n            });\n            itemElement.appendChild(removeButton);\n        }\n        // returns\n        return itemElement;\n    }\n    formatBytes(bytes, scale = 2) {\n        if (bytes === 0)\n            return '0 Bytes';\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        const value = parseFloat((bytes / Math.pow(k, i)).toFixed(scale));\n        return `${value} ${sizes[i]}`;\n    }\n    /**\n     * Adds file\n     */\n    addFile() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let _this = this;\n            let input = document.createElement('input');\n            input.setAttribute('type', 'file');\n            input.setAttribute('multiple', 'true');\n            input.addEventListener('change', function () {\n                return __awaiter(this, void 0, void 0, function* () {\n                    let files = Array.from(this[`files`]);\n                    if (_this.onAdd) {\n                        let result = yield _this.callOnAddListener(files);\n                        if (!result) {\n                            return false;\n                        }\n                        else {\n                            files = result;\n                        }\n                    }\n                    for (const file of files) {\n                        let item = {\n                            [_this.filenameProperty]: file.name,\n                            [_this.sizeProperty]: file.size\n                        };\n                        globalThis.Object.defineProperty(item, '_file_', { value: file, writable: true });\n                        _this.getBindData().push(item);\n                        _this.files.push(file);\n                    }\n                });\n            });\n            input.click();\n        });\n    }\n    /**\n     * Removes file\n     * @param index index\n     */\n    removeFile(index) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            let arrayProxy = this.getBindData();\n            let objectProxy = arrayProxy[index];\n            // calls on remove listener\n            if (this.onRemove) {\n                let result = yield this.callOnRemoveListener(objectProxy);\n                if (result === false) {\n                    return;\n                }\n            }\n            // if target file is exist, remove file\n            let targetFile = (_a = globalThis.Object.getOwnPropertyDescriptor(objectProxy, '_file_')) === null || _a === void 0 ? void 0 : _a.value;\n            if (targetFile) {\n                let fileIndex = this.files.findIndex(it => {\n                    return it === targetFile;\n                });\n                this.files.splice(fileIndex, 1);\n            }\n            arrayProxy.splice(index, 1);\n        });\n    }\n    /**\n     * Updates element\n     * @param object\n     */\n    doUpdate(object) {\n        this.render();\n    }\n    /**\n     * Creates style\n     */\n    createStyle() {\n        let style = document.createElement('style');\n        style.innerHTML = `\n            ${Configuration.getNamespace()}-files {\n                display: block;\n            }\n            .${Configuration.getNamespace()}-files__item {\n                display: flex;\n                gap: 0.25rem;\n                align-items: center;\n            }\n            .${Configuration.getNamespace()}-files__item > * {\n                display: inline-block;\n            }\n            .${Configuration.getNamespace()}-files__item-icon {\n                height: 1em;\n            }\n            .${Configuration.getNamespace()}-files__item-filename {\n            }\n            .${Configuration.getNamespace()}-files__item-size {\n            }\n            .${Configuration.getNamespace()}-files__item-remove {\n                cursor: pointer;\n            } \n            .${Configuration.getNamespace()}-files__item-add {\n                cursor: pointer;\n            }\n        `;\n        return style;\n    }\n    callOnAddListener(files) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield callFunction(this.onAdd, null, files);\n        });\n    }\n    callOnRemoveListener(item) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield callFunction(this.onRemove, null, item);\n        });\n    }\n}\n//# sourceMappingURL=FilesElement.js.map","import { Configuration, CustomElementFactory } from \"duice\";\nimport { ElementRegistry } from \"duice\";\nimport { FilesElement } from \"./FilesElement\";\n/**\n * File Element Factory\n */\nexport class FilesElementFactory extends CustomElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    doCreateElement(htmlElement, bindData, context) {\n        return new FilesElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-files`, new FilesElementFactory());\n})();\n//# sourceMappingURL=FilesElementFactory.js.map"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","FilesElement","CustomElement","constructor","htmlElement","bindData","context","super","this","iconContent","removeContent","addContent","filenameProperty","getElementAttribute","sizeProperty","files","findVariable","onClick","onAdd","onRemove","doRender","object","getHtmlElement","innerHTML","appendChild","createStyle","getBindData","forEach","file","index","itemElement","createItemElement","addButton","document","createElement","classList","add","Configuration","getNamespace","addEventListener","addFile","item","filename","size","parseInt","iconElement","filenameElement","style","cursor","console","log","callFunction","sizeElement","formatBytes","removeButton","dataset","toString","_this","removeFile","bytes","scale","i","Math","floor","parseFloat","pow","toFixed","input","setAttribute","Array","from","callOnAddListener","name","globalThis","Object","defineProperty","writable","push","click","_a","arrayProxy","objectProxy","callOnRemoveListener","targetFile","getOwnPropertyDescriptor","fileIndex","findIndex","it","splice","doUpdate","render","FilesElementFactory","CustomElementFactory","doCreateElement","ElementRegistry","register"],"mappings":"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"}