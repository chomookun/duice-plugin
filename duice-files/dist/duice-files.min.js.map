{"version":3,"file":"duice-files.min.js","sources":["FilesElement.js","FilesElementFactory.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Configuration, CustomElement, findVariable } from \"duice\";\nimport { getElementAttribute, callFunction } from \"duice\";\n/**\n * Files Element\n */\nexport class FilesElement extends CustomElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.iconContent = '<svg style=\"display:block;\" xmlns=\"http://www.w3.org/2000/svg\"  viewBox=\"0 0 50 50\" width=\"1rem\" height=\"1rem\"><path d=\"M 7 2 L 7 48 L 43 48 L 43 14.59375 L 42.71875 14.28125 L 30.71875 2.28125 L 30.40625 2 Z M 9 4 L 29 4 L 29 16 L 41 16 L 41 46 L 9 46 Z M 31 5.4375 L 39.5625 14 L 31 14 Z\"/></svg>';\n        this.removeContent = '[-]';\n        this.addContent = '[+]';\n        this.emptyContent = 'No files';\n        // attributes\n        this.filenameProperty = getElementAttribute(htmlElement, 'filename-property');\n        this.sizeProperty = getElementAttribute(htmlElement, 'size-property');\n        const files = getElementAttribute(htmlElement, 'files');\n        this.files = files ? findVariable(context, files) : null;\n        // event listeners\n        const onClick = getElementAttribute(htmlElement, 'on-click');\n        this.onClick = onClick ? findVariable(context, onClick) : null;\n        const onAdd = getElementAttribute(htmlElement, 'on-add');\n        this.onAdd = onAdd ? findVariable(context, onAdd) : null;\n        const onRemove = getElementAttribute(htmlElement, 'on-remove');\n        this.onRemove = onRemove ? findVariable(context, onRemove) : null;\n        // custom style\n        this.iconContent = getElementAttribute(htmlElement, 'icon-content') || this.iconContent;\n        this.removeContent = getElementAttribute(htmlElement, 'remove-content') || this.removeContent;\n        this.addContent = getElementAttribute(htmlElement, 'add-content') || this.addContent;\n    }\n    /**\n     * Do render\n     * @param object\n     */\n    doRender(object) {\n        this.getHtmlElement().innerHTML = '';\n        this.getHtmlElement().appendChild(this.createStyle());\n        // items\n        let arrayProxy = this.getBindData();\n        arrayProxy.forEach((file, index) => {\n            let itemElement = this.createItemElement(file, index);\n            this.getHtmlElement().appendChild(itemElement);\n        });\n        // item empty\n        if (arrayProxy.length === 0) {\n            let emptyElement = document.createElement('div');\n            emptyElement.innerHTML = `${this.emptyContent}`;\n            emptyElement.classList.add(`${Configuration.getNamespace()}-files__empty`);\n            this.getHtmlElement().appendChild(emptyElement);\n        }\n        // add button\n        if (this.files) {\n            let addButton = document.createElement('span');\n            addButton.innerHTML = this.addContent;\n            addButton.classList.add(`${Configuration.getNamespace()}-files__item-add`);\n            addButton.addEventListener('click', () => {\n                this.addFile().then();\n            });\n            this.getHtmlElement().appendChild(addButton);\n        }\n    }\n    createItemElement(item, index) {\n        let filename = item[this.filenameProperty];\n        let size = parseInt(item[this.sizeProperty]);\n        let itemElement = document.createElement('div');\n        itemElement.classList.add(`${Configuration.getNamespace()}-files__item`);\n        // icon\n        let iconElement = document.createElement('span');\n        iconElement.innerHTML = `${this.iconContent}`;\n        iconElement.classList.add(`${Configuration.getNamespace()}-files__item-icon`);\n        itemElement.appendChild(iconElement);\n        // filename\n        let filenameElement = document.createElement('span');\n        filenameElement.innerHTML = `${filename}`;\n        filenameElement.classList.add(`${Configuration.getNamespace()}-files__item-filename`);\n        itemElement.appendChild(filenameElement);\n        // on click listener\n        if (this.onClick) {\n            filenameElement.style.cursor = 'pointer';\n            filenameElement.classList.add(`${Configuration.getNamespace()}-files__item-filename--on-click`);\n            filenameElement.addEventListener('click', () => {\n                console.log(this.onClick);\n                callFunction(this.onClick, filenameElement, item);\n            });\n        }\n        // size\n        let sizeElement = document.createElement('span');\n        sizeElement.innerHTML = `(${this.formatBytes(size)})`;\n        sizeElement.classList.add(`${Configuration.getNamespace()}-files__item-size`);\n        itemElement.appendChild(sizeElement);\n        // remove button\n        if (this.files) {\n            let removeButton = document.createElement('span');\n            removeButton.innerHTML = this.removeContent;\n            removeButton.classList.add(`${Configuration.getNamespace()}-files__item-remove`);\n            removeButton.dataset.index = index.toString();\n            let _this = this;\n            removeButton.addEventListener('click', function () {\n                let index = parseInt(this.dataset.index);\n                _this.removeFile(index);\n            });\n            itemElement.appendChild(removeButton);\n        }\n        // returns\n        return itemElement;\n    }\n    formatBytes(bytes, scale = 2) {\n        if (bytes === 0)\n            return '0 Bytes';\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        const value = parseFloat((bytes / Math.pow(k, i)).toFixed(scale));\n        return `${value} ${sizes[i]}`;\n    }\n    /**\n     * Adds file\n     */\n    addFile() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let _this = this;\n            let input = document.createElement('input');\n            input.setAttribute('type', 'file');\n            input.setAttribute('multiple', 'true');\n            input.addEventListener('change', function () {\n                return __awaiter(this, void 0, void 0, function* () {\n                    let files = Array.from(this[`files`]);\n                    let items = [];\n                    if (_this.onAdd) {\n                        let result = yield _this.callOnAddListener(files);\n                        if (!result) {\n                            return false;\n                        }\n                        else {\n                            items.push(...result);\n                        }\n                    }\n                    else {\n                        for (const file of files) {\n                            let item = {\n                                [_this.filenameProperty]: file.name,\n                                [_this.sizeProperty]: file.size\n                            };\n                            items.push(item);\n                        }\n                    }\n                    // set file into item for deletion detection\n                    for (let i = 0; i < items.length; i++) {\n                        let item = items[i];\n                        let file = files[i];\n                        globalThis.Object.defineProperty(item, '_file_', { value: file, writable: true });\n                        _this.getBindData().push(item);\n                        _this.files.push(files[i]);\n                    }\n                });\n            });\n            input.click();\n        });\n    }\n    /**\n     * Removes file\n     * @param index index\n     */\n    removeFile(index) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            let arrayProxy = this.getBindData();\n            let objectProxy = arrayProxy[index];\n            // calls on remove listener\n            if (this.onRemove) {\n                let result = yield this.callOnRemoveListener(objectProxy);\n                if (result === false) {\n                    return;\n                }\n            }\n            // if target file is exist, remove file\n            let targetFile = (_a = globalThis.Object.getOwnPropertyDescriptor(objectProxy, '_file_')) === null || _a === void 0 ? void 0 : _a.value;\n            if (targetFile) {\n                let fileIndex = this.files.findIndex(it => {\n                    return it === targetFile;\n                });\n                this.files.splice(fileIndex, 1);\n            }\n            arrayProxy.splice(index, 1);\n        });\n    }\n    /**\n     * Updates element\n     * @param object\n     */\n    doUpdate(object) {\n        this.render();\n    }\n    /**\n     * Creates style\n     */\n    createStyle() {\n        let style = document.createElement('style');\n        style.innerHTML = `\n            ${Configuration.getNamespace()}-files {\n                display: block;\n            }\n            .${Configuration.getNamespace()}-files__item {\n                display: flex;\n                gap: 0.25rem;\n                align-items: center;\n            }\n            .${Configuration.getNamespace()}-files__item > * {\n                display: inline-block;\n            }\n            .${Configuration.getNamespace()}-files__item-icon {\n                height: 1em;\n                filter: invert(0.5);\n            }\n            .${Configuration.getNamespace()}-files__item-filename {\n            }\n            .${Configuration.getNamespace()}-files__item-filename--on-click:hover {\n                text-decoration: underline;\n            }\n            .${Configuration.getNamespace()}-files__item-size {\n            }\n            .${Configuration.getNamespace()}-files__item-remove {\n                cursor: pointer;\n            } \n            .${Configuration.getNamespace()}-files__item-add {\n                cursor: pointer;\n            }\n            .${Configuration.getNamespace()}-files__empty {\n            }\n        `;\n        return style;\n    }\n    callOnAddListener(files) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield callFunction(this.onAdd, null, files);\n        });\n    }\n    callOnRemoveListener(item) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield callFunction(this.onRemove, null, item);\n        });\n    }\n}\n//# sourceMappingURL=FilesElement.js.map","import { Configuration, CustomElementFactory } from \"duice\";\nimport { ElementRegistry } from \"duice\";\nimport { FilesElement } from \"./FilesElement\";\n/**\n * File Element Factory\n */\nexport class FilesElementFactory extends CustomElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    doCreateElement(htmlElement, bindData, context) {\n        return new FilesElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-files`, new FilesElementFactory());\n})();\n//# sourceMappingURL=FilesElementFactory.js.map"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","FilesElement","CustomElement","constructor","htmlElement","bindData","context","super","this","iconContent","removeContent","addContent","emptyContent","filenameProperty","getElementAttribute","sizeProperty","files","findVariable","onClick","onAdd","onRemove","doRender","object","getHtmlElement","innerHTML","appendChild","createStyle","arrayProxy","getBindData","forEach","file","index","itemElement","createItemElement","length","emptyElement","document","createElement","classList","add","Configuration","getNamespace","addButton","addEventListener","addFile","item","filename","size","parseInt","iconElement","filenameElement","style","cursor","console","log","callFunction","sizeElement","formatBytes","removeButton","dataset","toString","_this","removeFile","bytes","scale","i","Math","floor","parseFloat","pow","toFixed","input","setAttribute","Array","from","items","callOnAddListener","push","name","globalThis","Object","defineProperty","writable","click","_a","objectProxy","callOnRemoveListener","targetFile","getOwnPropertyDescriptor","fileIndex","findIndex","it","splice","doUpdate","render","FilesElementFactory","CustomElementFactory","doCreateElement","ElementRegistry","register"],"mappings":"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"}