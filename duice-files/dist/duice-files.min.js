/*!
 * duice-files - v0.3.3
 * git: https://gitbub.com/chomookun/duice-plugin
 * website: https://duice-plugin.chomookun.org
 * Released under the LGPL(GNU Lesser General Public License version 3) License
 */
this.duice=this.duice||{},this.duice.plugin=this.duice.plugin||{},this.duice.plugin.Files=function(e,t){"use strict";var n=function(e,t,n,i){return new(n||(n=Promise))((function(l,s){function o(e){try{r(i.next(e))}catch(e){s(e)}}function a(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}r((i=i.apply(e,t||[])).next())}))};class i extends t.CustomElement{constructor(e,n,i){super(e,n,i),this.iconContent='<svg style="display:block;" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="1rem" height="1rem"><path d="M 7 2 L 7 48 L 43 48 L 43 14.59375 L 42.71875 14.28125 L 30.71875 2.28125 L 30.40625 2 Z M 9 4 L 29 4 L 29 16 L 41 16 L 41 46 L 9 46 Z M 31 5.4375 L 39.5625 14 L 31 14 Z"/></svg>',this.removeContent="[-]",this.addContent="[+]",this.emptyContent="No files",this.filenameProperty=t.getElementAttribute(e,"filename-property"),this.sizeProperty=t.getElementAttribute(e,"size-property");const l=t.getElementAttribute(e,"files");this.files=l?t.findVariable(i,l):null;const s=t.getElementAttribute(e,"on-click");this.onClick=s?t.findVariable(i,s):null;const o=t.getElementAttribute(e,"on-add");this.onAdd=o?t.findVariable(i,o):null;const a=t.getElementAttribute(e,"on-remove");this.onRemove=a?t.findVariable(i,a):null,this.iconContent=t.getElementAttribute(e,"icon-content")||this.iconContent,this.removeContent=t.getElementAttribute(e,"remove-content")||this.removeContent,this.addContent=t.getElementAttribute(e,"add-content")||this.addContent}doRender(e){this.getHtmlElement().innerHTML="",this.getHtmlElement().appendChild(this.createStyle());let n=this.getBindData();if(n.forEach(((e,t)=>{let n=this.createItemElement(e,t);this.getHtmlElement().appendChild(n)})),0===n.length){let e=document.createElement("div");e.innerHTML=`${this.emptyContent}`,e.classList.add(`${t.Configuration.getNamespace()}-files__empty`),this.getHtmlElement().appendChild(e)}if(this.files){let e=document.createElement("span");e.innerHTML=this.addContent,e.classList.add(`${t.Configuration.getNamespace()}-files__item-add`),e.addEventListener("click",(()=>{this.addFile().then()})),this.getHtmlElement().appendChild(e)}}createItemElement(e,n){let i=e[this.filenameProperty],l=parseInt(e[this.sizeProperty]),s=document.createElement("div");s.classList.add(`${t.Configuration.getNamespace()}-files__item`);let o=document.createElement("span");o.innerHTML=`${this.iconContent}`,o.classList.add(`${t.Configuration.getNamespace()}-files__item-icon`),s.appendChild(o);let a=document.createElement("span");a.innerHTML=`${i}`,a.classList.add(`${t.Configuration.getNamespace()}-files__item-filename`),s.appendChild(a),this.onClick&&(a.style.cursor="pointer",a.classList.add(`${t.Configuration.getNamespace()}-files__item-filename--on-click`),a.addEventListener("click",(()=>{console.log(this.onClick),t.callFunction(this.onClick,a,e)})));let r=document.createElement("span");if(r.innerHTML=`(${this.formatBytes(l)})`,r.classList.add(`${t.Configuration.getNamespace()}-files__item-size`),s.appendChild(r),this.files){let e=document.createElement("span");e.innerHTML=this.removeContent,e.classList.add(`${t.Configuration.getNamespace()}-files__item-remove`),e.dataset.index=n.toString();let i=this;e.addEventListener("click",(function(){let e=parseInt(this.dataset.index);i.removeFile(e)})),s.appendChild(e)}return s}formatBytes(e,t=2){if(0===e)return"0 Bytes";const n=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,n)).toFixed(t))} ${["Bytes","KB","MB","GB","TB"][n]}`}addFile(){return n(this,void 0,void 0,(function*(){let e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("multiple","true"),t.addEventListener("change",(function(){return n(this,void 0,void 0,(function*(){let t=Array.from(this.files),n=[];if(e.onAdd){let i=yield e.callOnAddListener(t);if(!i)return!1;n.push(...i)}else for(const i of t){let t={[e.filenameProperty]:i.name,[e.sizeProperty]:i.size};n.push(t)}for(let i=0;i<n.length;i++){let l=n[i],s=t[i];globalThis.Object.defineProperty(l,"_file_",{value:s,writable:!0}),e.getBindData().push(l),e.files.push(t[i])}}))})),t.click()}))}removeFile(e){return n(this,void 0,void 0,(function*(){var t;let n=this.getBindData(),i=n[e];if(this.onRemove){if(!1===(yield this.callOnRemoveListener(i)))return}let l=null===(t=globalThis.Object.getOwnPropertyDescriptor(i,"_file_"))||void 0===t?void 0:t.value;if(l){let e=this.files.findIndex((e=>e===l));this.files.splice(e,1)}n.splice(e,1)}))}doUpdate(e){this.render()}createStyle(){let e=document.createElement("style");return e.innerHTML=`\n            ${t.Configuration.getNamespace()}-files {\n                display: block;\n            }\n            .${t.Configuration.getNamespace()}-files__item {\n                display: flex;\n                gap: 0.25rem;\n                align-items: center;\n            }\n            .${t.Configuration.getNamespace()}-files__item > * {\n                display: inline-block;\n            }\n            .${t.Configuration.getNamespace()}-files__item-icon {\n                height: 1em;\n                filter: invert(0.5);\n            }\n            .${t.Configuration.getNamespace()}-files__item-filename {\n            }\n            .${t.Configuration.getNamespace()}-files__item-filename--on-click:hover {\n                text-decoration: underline;\n            }\n            .${t.Configuration.getNamespace()}-files__item-size {\n            }\n            .${t.Configuration.getNamespace()}-files__item-remove {\n                cursor: pointer;\n            } \n            .${t.Configuration.getNamespace()}-files__item-add {\n                cursor: pointer;\n            }\n            .${t.Configuration.getNamespace()}-files__empty {\n            }\n        `,e}callOnAddListener(e){return n(this,void 0,void 0,(function*(){return yield t.callFunction(this.onAdd,null,e)}))}callOnRemoveListener(e){return n(this,void 0,void 0,(function*(){return yield t.callFunction(this.onRemove,null,e)}))}}class l extends t.CustomElementFactory{doCreateElement(e,t,n){return new i(e,t,n)}}return t.ElementRegistry.register(`${t.Configuration.getNamespace()}-files`,new l),e.FilesElement=i,e.FilesElementFactory=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({},duice);
//# sourceMappingURL=duice-files.min.js.map
