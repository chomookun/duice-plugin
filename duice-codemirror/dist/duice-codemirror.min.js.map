{"version":3,"file":"duice-codemirror.min.js","sources":["CodemirrorElement.js","CodemirrorElementFactory.js"],"sourcesContent":["import { getElementAttribute, ObjectElement } from \"duice\";\nimport { PropertyChangingEvent } from \"duice\";\n/**\n * Codemirror Element\n */\nexport class CodemirrorElement extends ObjectElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.mode = 'text/x-markdown';\n        this.theme = 'default';\n        this.getHtmlElement().style.display = 'block';\n        // option\n        this.mode = getElementAttribute(htmlElement, 'mode') || this.mode;\n        this.theme = getElementAttribute(htmlElement, 'theme') || this.theme;\n        // config\n        let config = {\n            mode: this.mode,\n            inputStyle: 'textarea',\n            lineNumbers: true,\n            theme: this.theme,\n            extraKeys: { \"Enter\": \"newlineAndIndentContinueMarkdownList\" }\n        };\n        // textarea\n        let textarea = document.createElement('textarea');\n        this.getHtmlElement().appendChild(textarea);\n        // create code mirror\n        this.codeMirror = CodeMirror.fromTextArea(textarea, config);\n        this.codeMirror.setSize('100%', '100%');\n        // refresh (not working without setTimeout)\n        setTimeout(() => {\n            this.codeMirror.refresh();\n        }, 1);\n        // add change event listener\n        this.codeMirror.on(\"blur\", () => {\n            let element = this.getHtmlElement();\n            let data = this.getBindData();\n            let event = new PropertyChangingEvent(element, data, this.getProperty(), this.getValue(), this.getIndex());\n            this.notifyObservers(event);\n        });\n    }\n    /**\n     * Sets value\n     * @param value property value\n     */\n    setValue(value) {\n        if (!value) {\n            value = '';\n        }\n        let scrollInfo = this.codeMirror.getScrollInfo();\n        this.codeMirror.doc.setValue(value);\n        this.codeMirror.scrollTo(scrollInfo.left, scrollInfo.top);\n    }\n    /**\n     * Gets value\n     */\n    getValue() {\n        let value = this.codeMirror.doc.getValue();\n        if (!value) {\n            return null;\n        }\n        return value;\n    }\n    /**\n     * Sets readonly\n     * @param readonly readonly or not\n     */\n    setReadonly(readonly) {\n        this.codeMirror.setOption('readOnly', readonly);\n    }\n}\n//# sourceMappingURL=CodemirrorElement.js.map","import { Configuration, ElementRegistry, ObjectElementFactory } from \"duice\";\nimport { CodemirrorElement } from \"./CodemirrorElement\";\n/**\n * Codemirror Factory\n */\nexport class CodemirrorElementFactory extends ObjectElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    createElement(htmlElement, bindData, context) {\n        return new CodemirrorElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-codemirror`, new CodemirrorElementFactory());\n})();\n//# sourceMappingURL=CodemirrorElementFactory.js.map"],"names":["CodemirrorElement","ObjectElement","constructor","htmlElement","bindData","context","super","this","mode","theme","getHtmlElement","style","display","getElementAttribute","config","inputStyle","lineNumbers","extraKeys","Enter","textarea","document","createElement","appendChild","codeMirror","CodeMirror","fromTextArea","setSize","setTimeout","refresh","on","element","data","getBindData","event","PropertyChangingEvent","getProperty","getValue","getIndex","notifyObservers","setValue","value","scrollInfo","getScrollInfo","doc","scrollTo","left","top","setReadonly","readonly","setOption","CodemirrorElementFactory","ObjectElementFactory","ElementRegistry","register","Configuration","getNamespace"],"mappings":";;;;;;0HAKO,MAAMA,UAA0BC,EAAAA,cAOnC,WAAAC,CAAYC,EAAaC,EAAUC,GAC/BC,MAAMH,EAAaC,EAAUC,GAC7BE,KAAKC,KAAO,kBACZD,KAAKE,MAAQ,UACbF,KAAKG,iBAAiBC,MAAMC,QAAU,QAEtCL,KAAKC,KAAOK,sBAAoBV,EAAa,SAAWI,KAAKC,KAC7DD,KAAKE,MAAQI,sBAAoBV,EAAa,UAAYI,KAAKE,MAE/D,IAAIK,EAAS,CACTN,KAAMD,KAAKC,KACXO,WAAY,WACZC,aAAa,EACbP,MAAOF,KAAKE,MACZQ,UAAW,CAAEC,MAAS,yCAGtBC,EAAWC,SAASC,cAAc,YACtCd,KAAKG,iBAAiBY,YAAYH,GAElCZ,KAAKgB,WAAaC,WAAWC,aAAaN,EAAUL,GACpDP,KAAKgB,WAAWG,QAAQ,OAAQ,QAEhCC,YAAW,KACPpB,KAAKgB,WAAWK,SAAS,GAC1B,GAEHrB,KAAKgB,WAAWM,GAAG,QAAQ,KACvB,IAAIC,EAAUvB,KAAKG,iBACfqB,EAAOxB,KAAKyB,cACZC,EAAQ,IAAIC,EAAAA,sBAAsBJ,EAASC,EAAMxB,KAAK4B,cAAe5B,KAAK6B,WAAY7B,KAAK8B,YAC/F9B,KAAK+B,gBAAgBL,EAAM,GAElC,CAKD,QAAAM,CAASC,GACAA,IACDA,EAAQ,IAEZ,IAAIC,EAAalC,KAAKgB,WAAWmB,gBACjCnC,KAAKgB,WAAWoB,IAAIJ,SAASC,GAC7BjC,KAAKgB,WAAWqB,SAASH,EAAWI,KAAMJ,EAAWK,IACxD,CAID,QAAAV,GACI,IAAII,EAAQjC,KAAKgB,WAAWoB,IAAIP,WAChC,OAAKI,GACM,IAGd,CAKD,WAAAO,CAAYC,GACRzC,KAAKgB,WAAW0B,UAAU,WAAYD,EACzC,ECrEE,MAAME,UAAiCC,EAAAA,qBAO1C,aAAA9B,CAAclB,EAAaC,EAAUC,GACjC,OAAO,IAAIL,EAAkBG,EAAaC,EAAUC,EACvD,SAOD+C,kBAAgBC,SAAS,GAAGC,gBAAcC,4BAA6B,IAAIL"}