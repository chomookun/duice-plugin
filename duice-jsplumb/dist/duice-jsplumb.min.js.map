{"version":3,"file":"duice-jsplumb.min.js","sources":["JsplumbElement.js","JsplumbElementFactory.js"],"sourcesContent":["import { Configuration, Initializer, CustomElement, getElementAttribute, markInitialized, ObjectProxy, setElementAttribute, } from \"duice\";\n/**\n * Jsplumb Element\n */\nexport class JsplumbElement extends CustomElement {\n    /**\n     * Constructor\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    constructor(htmlElement, bindData, context) {\n        super(htmlElement, bindData, context);\n        this.elementItems = new Map();\n        this.sourceEndpoints = new Map();\n        this.targetEndpoints = new Map();\n        this.connectorItems = [];\n        // parse attribute\n        this.elementProperty = getElementAttribute(this.getHtmlElement(), 'element-property');\n        this.elementLoop = getElementAttribute(this.getHtmlElement(), 'element-loop');\n        this.elementIdProperty = getElementAttribute(this.getHtmlElement(), 'element-id-property');\n        let positionProperty = getElementAttribute(this.getHtmlElement(), 'element-position-property');\n        let positionPropertyParts = positionProperty.split(',');\n        this.elementPositionXProperty = positionPropertyParts[0];\n        this.elementPositionYProperty = positionPropertyParts[1];\n        this.connectorProperty = getElementAttribute(this.getHtmlElement(), 'connector-property');\n        this.connectorSourceProperty = getElementAttribute(this.getHtmlElement(), 'connector-source-property');\n        this.connectorTargetProperty = getElementAttribute(this.getHtmlElement(), 'connector-target-property');\n        // mark initialized (not using after clone as templates)\n        this.htmlElementTemplate = this.getHtmlElement().innerHTML;\n        markInitialized(htmlElement);\n        this.getHtmlElement().innerHTML = '';\n        this.container = document.createElement('div');\n        this.container.classList.add(Configuration.getNamespace() + '-diagram-container');\n        this.container.style.position = 'relative';\n        this.container.style.width = '100%';\n        this.container.style.height = '100%';\n        this.container.style.overflow = 'hidden';\n        this.container.classList.add(Configuration.getNamespace() + '-diagram-container');\n        this.container.addEventListener('click', event => {\n            event.preventDefault();\n        });\n        this.getHtmlElement().appendChild(this.createStyle());\n        this.jsPlumbInstance = jsPlumb.getInstance({\n            container: this.container,\n        });\n        this.getHtmlElement().appendChild(this.container);\n        this.jsPlumbInstance.bind('connection', (event, mouseEvent) => {\n            console.debug('== connection:', event, mouseEvent);\n            if (!mouseEvent) {\n                return;\n            }\n            event.connection.addOverlay([\"PlainArrow\", {\n                    location: 1,\n                    width: 10,\n                    length: 10,\n                    id: \"arrow\",\n                }]);\n            event.connection.addOverlay(['Label', {\n                    label: '<span style=\"cursor:pointer; font-weight:bold;\">[X]</span>',\n                    location: 0.5,\n                    events: {\n                        click: (labelOverlay, originalEvent) => {\n                            this.jsPlumbInstance.deleteConnection(event.connection);\n                        }\n                    }\n                }]);\n            let connectorSourceId = getElementAttribute(event.connection.source, 'element-id');\n            let connectorTargetId = getElementAttribute(event.connection.target, 'element-id');\n            this.addConnectorData(connectorSourceId, connectorTargetId);\n        });\n        this.jsPlumbInstance.bind('connectionMoved', event => {\n            console.debug('== connectionMoved:', event);\n            let connectorSourceId = getElementAttribute(event.originalSourceEndpoint.element, 'element-id');\n            let connectorTargetId = getElementAttribute(event.originalTargetEndpoint.element, 'element-id');\n            this.removeConnectorData(connectorSourceId, connectorTargetId);\n        });\n        this.jsPlumbInstance.bind('internal.connectionDetached', event => {\n            console.debug('== internal.connectionDetached:', event);\n            let connectorSourceId = getElementAttribute(event.connection.source, 'element-id');\n            let connectorTargetId = getElementAttribute(event.connection.target, 'element-id');\n            this.removeConnectorData(connectorSourceId, connectorTargetId);\n        });\n    }\n    /**\n     * Creates style\n     */\n    createStyle() {\n        let style = document.createElement('style');\n        style.innerHTML = `\n            .${Configuration.getNamespace()}-diagram-container {\n                background-size: 1rem 1rem;\n                background-image: radial-gradient(circle, rgba(128, 128, 128, 0.25) 1px, rgba(0, 0, 0, 0) 1px);\n            }\n            .${Configuration.getNamespace()}-diagram-element {\n            }\n            .${Configuration.getNamespace()}-diagram-endpoint-source {\n                cursor: pointer;\n                opacity: 0.5;\n            }\n            .${Configuration.getNamespace()}-diagram-endpoint-source-hover {\n                opacity: 1.0;\n            }\n            .${Configuration.getNamespace()}-diagram-endpoint-target {\n                opacity: 0.5;\n            }\n            .${Configuration.getNamespace()}-diagram-endpoint-target-hover {\n                opacity: 1.0;\n            }\n            .${Configuration.getNamespace()}-diagram-connector-disconnect {\n                display: block;\n                cursor: pointer;\n                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVR4nGNgoBHgZ2Bg0GJgYDCHYhCbjxiNrAwMDFYMDAyROLAVVA1OzV54NMOwJy5DrIjQDMOW2PwciYQfMjAwLETiL4SKIatBCRNtNEmQhn9QGpmNrAYUsHBgjsWZc6Aa/2PRHAnVg9eARVDNIEOWYZE3o6oX+EgMxAhsCcuKkmhkgCYOUCIhOyHBDAGZjk0jyNkgOZya0cMEOTNpEpuZSAYAwus8FYS1LyQAAAAASUVORK5CYII=');\n                background-size: 15px 15px;\n                width: 15px;\n                height: 15px;\n                opacity: 0.5;\n            }\n            .${Configuration.getNamespace()}-diagram-connector-disconnect:hover {\n                opacity: 1;\n            }\n        `;\n        return style;\n    }\n    /**\n     * Do render\n     * @param object object\n     */\n    doRender(object) {\n        var _a;\n        console.debug(\"doRender:\", object);\n        this.clearContainer();\n        this.jsPlumbInstance.setSuspendDrawing(true);\n        let elementArray = this.bindData[this.elementProperty];\n        let elementLoopArgs = this.elementLoop.split(',');\n        let elementItemName = elementLoopArgs[0].trim();\n        let elementStatusName = (_a = elementLoopArgs[1]) === null || _a === void 0 ? void 0 : _a.trim();\n        for (let index = 0; index < elementArray.length; index++) {\n            let elementObject = elementArray[index];\n            let context = Object.assign({}, this.getContext());\n            context[elementItemName] = elementObject;\n            context[elementStatusName] = new ObjectProxy({\n                index: index,\n                count: index + 1,\n                size: elementArray.length,\n                first: (index === 0),\n                last: (elementArray.length == index + 1)\n            });\n            this.createElementItem(elementObject, context, index);\n        }\n        let connectorArray = this.bindData[this.connectorProperty];\n        for (let index = 0; index < connectorArray.length; index++) {\n            this.createConnectorItem(connectorArray[index]);\n        }\n        this.jsPlumbInstance.setSuspendDrawing(false, true);\n        this.fitContainerToContent();\n    }\n    /**\n     * Do update\n     * @param object object\n     */\n    doUpdate(object) {\n        console.debug(\"doUpdate:\", object);\n        this.doRender(object);\n    }\n    /**\n     * Clears container\n     */\n    clearContainer() {\n        this.container.innerHTML = '';\n        this.elementItems.clear();\n        this.sourceEndpoints.clear();\n        this.targetEndpoints.clear();\n        this.connectorItems.length = 0;\n    }\n    /**\n     * Fits container to content\n     */\n    fitContainerToContent() {\n        let maxWidth = 0;\n        let maxHeight = 0;\n        this.container.querySelectorAll(`.${Configuration.getNamespace()}-diagram-element`)\n            .forEach(element => {\n            let rect = element.getBoundingClientRect();\n            let width = parseInt(element.style.left) + rect.width;\n            if (width > maxWidth) {\n                maxWidth = width;\n            }\n            let height = parseInt(element.style.top) + rect.height;\n            if (height > maxHeight) {\n                maxHeight = height;\n            }\n        });\n        maxWidth += 10;\n        maxHeight += 10;\n        this.container.style.width = maxWidth + 'px';\n        this.container.style.height = maxHeight + 'px';\n        let rect = this.getHtmlElement().parentElement.getBoundingClientRect();\n        if (maxWidth < rect.width) {\n            this.container.style.width = rect.width + 'px';\n        }\n        if (maxHeight < rect.height) {\n            this.container.style.height = rect.height + 'px';\n        }\n    }\n    /**\n     * Creates element item\n     * @param elementObject element object\n     * @param context context\n     * @param index index\n     */\n    createElementItem(elementObject, context, index) {\n        console.debug(\"createElementItem\", elementObject, context, index);\n        let elementId = elementObject[this.elementIdProperty];\n        let elementItem = document.createElement('div');\n        elementItem.innerHTML = this.htmlElementTemplate;\n        Initializer.initialize(elementItem, context, index);\n        setElementAttribute(elementItem, 'element-id', elementId);\n        elementItem.classList.add(Configuration.getNamespace() + '-diagram-element');\n        elementItem.style.position = 'absolute';\n        elementItem.style.left = (elementObject[this.elementPositionXProperty] || 10) + 'px';\n        elementItem.style.top = (elementObject[this.elementPositionYProperty] || 10) + 'px';\n        this.elementItems.set(elementId, elementItem);\n        this.container.appendChild(elementItem);\n        if (this.isEditable()) {\n            elementItem.style.cursor = 'move';\n            this.jsPlumbInstance.draggable(elementItem, {\n                stop: event => {\n                    console.debug(event.finalPos);\n                    elementObject[this.elementPositionXProperty] = event.finalPos[0];\n                    elementObject[this.elementPositionYProperty] = event.finalPos[1];\n                    this.fitContainerToContent();\n                }\n            });\n        }\n        // source end point\n        let sourceEndpoint = this.jsPlumbInstance.addEndpoint(elementItem, {\n            isSource: this.isEditable(),\n            isTarget: false,\n            maxConnections: -1,\n            anchor: ['Continuous', { faces: ['bottom', 'right', 'top', 'left'] }],\n            endpoint: ['Rectangle', { width: 10, height: 10, cssClass: `${Configuration.getNamespace()}-diagram-endpoint-source`, hoverClass: `${Configuration.getNamespace()}-diagram-endpoint-source-hover` }],\n            endpointStyle: { fill: \"darkgray\", outlineStroke: 'black' },\n            connector: 'Straight',\n        });\n        this.sourceEndpoints.set(elementId, sourceEndpoint);\n        // target end point\n        let targetEndpoint = this.jsPlumbInstance.addEndpoint(elementItem, {\n            isTarget: this.isEditable(),\n            isSource: false,\n            maxConnections: -1,\n            anchor: ['Continuous', { faces: ['top', 'left', 'bottom', 'right'] }],\n            endpoint: ['Dot', { radius: 6, cssClass: `${Configuration.getNamespace()}-diagram-endpoint-target`, hoverClass: `${Configuration.getNamespace()}-diagram-endpoint-target-hover` }],\n            endpointStyle: { fill: \"gray\" },\n        });\n        this.targetEndpoints.set(elementId, targetEndpoint);\n    }\n    /**\n     * Creates connector item\n     * @param connectorObject connector object\n     */\n    createConnectorItem(connectorObject) {\n        let connectorSourceId = connectorObject[this.connectorSourceProperty];\n        let connectorTargetId = connectorObject[this.connectorTargetProperty];\n        let connectorItem = this.jsPlumbInstance.connect({\n            source: this.sourceEndpoints.get(connectorSourceId),\n            target: this.targetEndpoints.get(connectorTargetId),\n            connector: 'Straight',\n            detachable: this.isEditable(),\n            overlays: [\n                [\"PlainArrow\", {\n                        location: 1,\n                        width: 10,\n                        length: 10,\n                        id: \"arrow\"\n                    }],\n                ['Label', {\n                        label: `<span class=\"${Configuration.getNamespace() + '-diagram-connector-disconnect'}\"></span>`,\n                        location: 0.5,\n                        events: {\n                            click: (labelOverlay, originalEvent) => {\n                                if (this.isEditable()) {\n                                    this.jsPlumbInstance.deleteConnection(connectorItem);\n                                }\n                            }\n                        }\n                    }]\n            ]\n        });\n        this.connectorItems.push(connectorItem);\n    }\n    /**\n     * Adds connector data\n     * @param connectorSourceId connector source id\n     * @param connectorTargetId connector target id\n     */\n    addConnectorData(connectorSourceId, connectorTargetId) {\n        console.debug(\"addConnectorData\", connectorSourceId, connectorTargetId);\n        let connectorArray = this.bindData[this.connectorProperty];\n        let index = connectorArray.findIndex(connectorObject => {\n            return connectorObject[this.connectorSourceProperty] === connectorSourceId\n                && connectorObject[this.connectorTargetProperty] === connectorTargetId;\n        });\n        if (index < 0) {\n            let connectorData = {};\n            connectorData[this.connectorSourceProperty] = connectorSourceId;\n            connectorData[this.connectorTargetProperty] = connectorTargetId;\n            connectorArray.push(connectorData);\n        }\n    }\n    /**\n     * Removes connector data\n     * @param connectorSourceId connector source id\n     * @param connectorTargetId connector target id\n     */\n    removeConnectorData(connectorSourceId, connectorTargetId) {\n        console.debug(\"removeConnectorData\", connectorSourceId, connectorTargetId);\n        let linkArray = this.bindData[this.connectorProperty];\n        let indexToRemove = linkArray.findIndex(linkObject => {\n            return linkObject[this.connectorSourceProperty] === connectorSourceId\n                && linkObject[this.connectorTargetProperty] === connectorTargetId;\n        });\n        console.debug(\"== indexToRemove:\", indexToRemove);\n        if (indexToRemove > -1) {\n            linkArray.splice(indexToRemove, 1);\n        }\n    }\n    /**\n     * Returns if editable\n     */\n    isEditable() {\n        return !ObjectProxy.isReadonlyAll(this.bindData)\n            && !ObjectProxy.isDisableAll(this.bindData);\n    }\n}\n//# sourceMappingURL=JsplumbElement.js.map","import { Configuration, CustomElementFactory, ElementRegistry } from \"duice\";\nimport { JsplumbElement } from \"./JsplumbElement\";\nexport class JsplumbElementFactory extends CustomElementFactory {\n    /**\n     * Creates element\n     * @param htmlElement html element\n     * @param bindData bind data\n     * @param context context\n     */\n    doCreateElement(htmlElement, bindData, context) {\n        return new JsplumbElement(htmlElement, bindData, context);\n    }\n}\n/**\n * Static block\n */\n(() => {\n    // register\n    ElementRegistry.register(`${Configuration.getNamespace()}-jsplumb`, new JsplumbElementFactory());\n})();\n//# sourceMappingURL=JsplumbElementFactory.js.map"],"names":["JsplumbElement","CustomElement","constructor","htmlElement","bindData","context","super","this","elementItems","Map","sourceEndpoints","targetEndpoints","connectorItems","elementProperty","getElementAttribute","getHtmlElement","elementLoop","elementIdProperty","positionPropertyParts","split","elementPositionXProperty","elementPositionYProperty","connectorProperty","connectorSourceProperty","connectorTargetProperty","htmlElementTemplate","innerHTML","markInitialized","container","document","createElement","classList","add","Configuration","getNamespace","style","position","width","height","overflow","addEventListener","event","preventDefault","appendChild","createStyle","jsPlumbInstance","jsPlumb","getInstance","bind","mouseEvent","console","debug","connection","addOverlay","location","length","id","label","events","click","labelOverlay","originalEvent","deleteConnection","connectorSourceId","source","connectorTargetId","target","addConnectorData","originalSourceEndpoint","element","originalTargetEndpoint","removeConnectorData","doRender","object","_a","clearContainer","setSuspendDrawing","elementArray","elementLoopArgs","elementItemName","trim","elementStatusName","index","elementObject","Object","assign","getContext","ObjectProxy","count","size","first","last","createElementItem","connectorArray","createConnectorItem","fitContainerToContent","doUpdate","clear","maxWidth","maxHeight","querySelectorAll","forEach","rect","getBoundingClientRect","parseInt","left","top","parentElement","elementId","elementItem","Initializer","initialize","setElementAttribute","set","isEditable","cursor","draggable","stop","finalPos","sourceEndpoint","addEndpoint","isSource","isTarget","maxConnections","anchor","faces","endpoint","cssClass","hoverClass","endpointStyle","fill","outlineStroke","connector","targetEndpoint","radius","connectorObject","connectorItem","connect","get","detachable","overlays","push","findIndex","connectorData","linkArray","indexToRemove","linkObject","splice","isReadonlyAll","isDisableAll","JsplumbElementFactory","CustomElementFactory","doCreateElement","ElementRegistry","register"],"mappings":"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"}