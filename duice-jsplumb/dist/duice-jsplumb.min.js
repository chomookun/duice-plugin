var duiceJsplumb=function(e,t){"use strict";class n extends t.CustomElement{constructor(e,n,i){super(e,n,i),this.elementItems=new Map,this.sourceEndpoints=new Map,this.targetEndpoints=new Map,this.connectorItems=[],this.elementProperty=t.getElementAttribute(this.getHtmlElement(),"element-property"),this.elementLoop=t.getElementAttribute(this.getHtmlElement(),"element-loop"),this.elementIdProperty=t.getElementAttribute(this.getHtmlElement(),"element-id-property");let o=t.getElementAttribute(this.getHtmlElement(),"element-position-property").split(",");this.elementPositionXProperty=o[0],this.elementPositionYProperty=o[1],this.connectorProperty=t.getElementAttribute(this.getHtmlElement(),"connector-property"),this.connectorSourceProperty=t.getElementAttribute(this.getHtmlElement(),"connector-source-property"),this.connectorTargetProperty=t.getElementAttribute(this.getHtmlElement(),"connector-target-property"),this.htmlElementTemplate=this.getHtmlElement().innerHTML,t.markInitialized(e),this.getHtmlElement().innerHTML="",this.container=document.createElement("div"),this.container.classList.add(t.Configuration.getNamespace()+"-diagram-container"),this.container.style.position="relative",this.container.style.width="100%",this.container.style.height="100%",this.container.style.overflow="hidden",this.container.classList.add(t.Configuration.getNamespace()+"-diagram-container"),this.container.addEventListener("click",(e=>{e.preventDefault()})),this.getHtmlElement().appendChild(this.createStyle()),this.jsPlumbInstance=jsPlumb.getInstance({container:this.container}),this.getHtmlElement().appendChild(this.container),this.jsPlumbInstance.bind("connection",((e,n)=>{if(console.debug("== connection:",e,n),!n)return;e.connection.addOverlay(["PlainArrow",{location:1,width:10,length:10,id:"arrow"}]),e.connection.addOverlay(["Label",{label:'<span style="cursor:pointer; font-weight:bold;">[X]</span>',location:.5,events:{click:(t,n)=>{this.jsPlumbInstance.deleteConnection(e.connection)}}}]);let i=t.getElementAttribute(e.connection.source,"element-id"),o=t.getElementAttribute(e.connection.target,"element-id");this.addConnectorData(i,o)})),this.jsPlumbInstance.bind("connectionMoved",(e=>{console.debug("== connectionMoved:",e);let n=t.getElementAttribute(e.originalSourceEndpoint.element,"element-id"),i=t.getElementAttribute(e.originalTargetEndpoint.element,"element-id");this.removeConnectorData(n,i)})),this.jsPlumbInstance.bind("internal.connectionDetached",(e=>{console.debug("== internal.connectionDetached:",e);let n=t.getElementAttribute(e.connection.source,"element-id"),i=t.getElementAttribute(e.connection.target,"element-id");this.removeConnectorData(n,i)}))}createStyle(){let e=document.createElement("style");return e.innerHTML=`\n            .${t.Configuration.getNamespace()}-diagram-container {\n                background-size: 1rem 1rem;\n                background-image: radial-gradient(circle, rgba(128, 128, 128, 0.25) 1px, rgba(0, 0, 0, 0) 1px);\n            }\n            .${t.Configuration.getNamespace()}-diagram-element {\n            }\n            .${t.Configuration.getNamespace()}-diagram-endpoint-source {\n                cursor: pointer;\n                opacity: 0.5;\n            }\n            .${t.Configuration.getNamespace()}-diagram-endpoint-source-hover {\n                opacity: 1.0;\n            }\n            .${t.Configuration.getNamespace()}-diagram-endpoint-target {\n                opacity: 0.5;\n            }\n            .${t.Configuration.getNamespace()}-diagram-endpoint-target-hover {\n                opacity: 1.0;\n            }\n            .${t.Configuration.getNamespace()}-diagram-connector-disconnect {\n                display: block;\n                cursor: pointer;\n                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVR4nGNgoBHgZ2Bg0GJgYDCHYhCbjxiNrAwMDFYMDAyROLAVVA1OzV54NMOwJy5DrIjQDMOW2PwciYQfMjAwLETiL4SKIatBCRNtNEmQhn9QGpmNrAYUsHBgjsWZc6Aa/2PRHAnVg9eARVDNIEOWYZE3o6oX+EgMxAhsCcuKkmhkgCYOUCIhOyHBDAGZjk0jyNkgOZya0cMEOTNpEpuZSAYAwus8FYS1LyQAAAAASUVORK5CYII=');\n                background-size: 15px 15px;\n                width: 15px;\n                height: 15px;\n                opacity: 0.5;\n            }\n            .${t.Configuration.getNamespace()}-diagram-connector-disconnect:hover {\n                opacity: 1;\n            }\n        `,e}doRender(e){var n;console.debug("doRender:",e),this.clearContainer(),this.jsPlumbInstance.setSuspendDrawing(!0);let i=this.bindData[this.elementProperty],o=this.elementLoop.split(","),r=o[0].trim(),a=null===(n=o[1])||void 0===n?void 0:n.trim();for(let e=0;e<i.length;e++){let n=i[e],o=Object.assign({},this.getContext());o[r]=n,o[a]=new t.ObjectProxy({index:e,count:e+1,size:i.length,first:0===e,last:i.length==e+1}),this.createElementItem(n,o,e)}let s=this.bindData[this.connectorProperty];for(let e=0;e<s.length;e++)this.createConnectorItem(s[e]);this.jsPlumbInstance.setSuspendDrawing(!1,!0),this.fitContainerToContent()}doUpdate(e){console.debug("doUpdate:",e),this.doRender(e)}clearContainer(){this.container.innerHTML="",this.elementItems.clear(),this.sourceEndpoints.clear(),this.targetEndpoints.clear(),this.connectorItems.length=0}fitContainerToContent(){let e=0,n=0;this.container.querySelectorAll(`.${t.Configuration.getNamespace()}-diagram-element`).forEach((t=>{let i=t.getBoundingClientRect(),o=parseInt(t.style.left)+i.width;o>e&&(e=o);let r=parseInt(t.style.top)+i.height;r>n&&(n=r)})),e+=10,n+=10,this.container.style.width=e+"px",this.container.style.height=n+"px";let i=this.getHtmlElement().parentElement.getBoundingClientRect();e<i.width&&(this.container.style.width=i.width+"px"),n<i.height&&(this.container.style.height=i.height+"px")}createElementItem(e,n,i){console.debug("createElementItem",e,n,i);let o=e[this.elementIdProperty],r=document.createElement("div");r.innerHTML=this.htmlElementTemplate,t.Initializer.initialize(r,n,i),t.setElementAttribute(r,"element-id",o),r.classList.add(t.Configuration.getNamespace()+"-diagram-element"),r.style.position="absolute",r.style.left=(e[this.elementPositionXProperty]||10)+"px",r.style.top=(e[this.elementPositionYProperty]||10)+"px",this.elementItems.set(o,r),this.container.appendChild(r),this.isEditable()&&(r.style.cursor="move",this.jsPlumbInstance.draggable(r,{stop:t=>{console.debug(t.finalPos),e[this.elementPositionXProperty]=t.finalPos[0],e[this.elementPositionYProperty]=t.finalPos[1],this.fitContainerToContent()}}));let a=this.jsPlumbInstance.addEndpoint(r,{isSource:this.isEditable(),isTarget:!1,maxConnections:-1,anchor:["Continuous",{faces:["bottom","right","top","left"]}],endpoint:["Rectangle",{width:10,height:10,cssClass:`${t.Configuration.getNamespace()}-diagram-endpoint-source`,hoverClass:`${t.Configuration.getNamespace()}-diagram-endpoint-source-hover`}],endpointStyle:{fill:"darkgray",outlineStroke:"black"},connector:"Straight"});this.sourceEndpoints.set(o,a);let s=this.jsPlumbInstance.addEndpoint(r,{isTarget:this.isEditable(),isSource:!1,maxConnections:-1,anchor:["Continuous",{faces:["top","left","bottom","right"]}],endpoint:["Dot",{radius:6,cssClass:`${t.Configuration.getNamespace()}-diagram-endpoint-target`,hoverClass:`${t.Configuration.getNamespace()}-diagram-endpoint-target-hover`}],endpointStyle:{fill:"gray"}});this.targetEndpoints.set(o,s)}createConnectorItem(e){let n=e[this.connectorSourceProperty],i=e[this.connectorTargetProperty],o=this.jsPlumbInstance.connect({source:this.sourceEndpoints.get(n),target:this.targetEndpoints.get(i),connector:"Straight",detachable:this.isEditable(),overlays:[["PlainArrow",{location:1,width:10,length:10,id:"arrow"}],["Label",{label:`<span class="${t.Configuration.getNamespace()+"-diagram-connector-disconnect"}"></span>`,location:.5,events:{click:(e,t)=>{this.isEditable()&&this.jsPlumbInstance.deleteConnection(o)}}}]]});this.connectorItems.push(o)}addConnectorData(e,t){console.debug("addConnectorData",e,t);let n=this.bindData[this.connectorProperty];if(n.findIndex((n=>n[this.connectorSourceProperty]===e&&n[this.connectorTargetProperty]===t))<0){let i={};i[this.connectorSourceProperty]=e,i[this.connectorTargetProperty]=t,n.push(i)}}removeConnectorData(e,t){console.debug("removeConnectorData",e,t);let n=this.bindData[this.connectorProperty],i=n.findIndex((n=>n[this.connectorSourceProperty]===e&&n[this.connectorTargetProperty]===t));console.debug("== indexToRemove:",i),i>-1&&n.splice(i,1)}isEditable(){return!t.ObjectProxy.isReadonlyAll(this.bindData)&&!t.ObjectProxy.isDisableAll(this.bindData)}}class i extends t.CustomElementFactory{doCreateElement(e,t,i){return new n(e,t,i)}}return t.DataElementRegistry.register(`${t.Configuration.getNamespace()}-jsplumb`,new i),e.DiagramFactory=i,e.Jsplumb=n,Object.defineProperty(e,"__esModule",{value:!0}),e}({},duice);
//# sourceMappingURL=duice-jsplumb.min.js.map
